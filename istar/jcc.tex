% Modified for use with JCC - Madhusudan Singh Copyright (C) (2012). All rights reserved.
\documentclass[12pt]{article}

\setlength{\oddsidemargin}{0in}  %left margin position, reference is one inch
\setlength{\textwidth}{6.5in}    %width of text=8.5-1in-1in for margin
\setlength{\topmargin}{-0.5in}    %reference is at 1.5in, -.5in gives a start of about 1in from top
\setlength{\textheight}{9in}     %length of text=11in-1in-1in (top and bot. marg.) 
\newenvironment{wileykeywords}{\textsf{Keywords:}\hspace{\stretch{1}}}{\hspace{\stretch{1}}\rule{1ex}{1ex}}

\usepackage{amsmath,amssymb}
\usepackage{graphicx}% Include figure files
%\usepackage{caption}
\usepackage{color}% Include colors for document elements
\usepackage{dcolumn}% Align table columns on decimal point
%\usepackage{bm}% bold math
\usepackage[numbers,super,comma,sort&compress]{natbib}
%\usepackage[nolists, nomarkers, figuresfirst]{endfloat}
\usepackage{subfig}
\usepackage{booktabs}

\definecolor{background-color}{gray}{0.98}

\title{ Software-as-a-Service Platform with Large-Scale Online Protein-Ligand Docking}
\author{Hongjian Li, Kwong-Sak Leung and Man-Hon Wong\thanks{The authors are with Department of Computer Science and Engineering, Chinese University of Hong Kong}}

\begin{document}

\maketitle

\begin{abstract}
We were motivated by the desire to automate large-scale protein-ligand docking using our docking engine idock and thus have developed istar, a SaaS (Software as a Service) platform capable of hosting a general variety of software online. Without tedious software installation, users, especially computational chemists, can submit jobs on the fly either by browsing our web site or by programming against our RESTful API. Our HTML5- and CSS3-powered istar web site supports 1) selecting ligands with desired molecular properties and previewing the number of ligands to dock, 2) monitoring job progress in real time, and 3) outputing predicted free energy, ligand efficiency, putative hydrogen bonds, and supplier information, three unique and useful features commonly lacked on other online docking platforms like DOCK Blaster or iScreen. We have collected 12,171,187 yuck-free ligands from the clean subset of the ZINC database with conditional permission from its developer. We have revised our docking engine idock to version 1.6, further improving docking speed and accuracy, inventing new functionalities, and fixing bugs. To better evaluate and compare idock 1.6 with the state-of-the-art AutoDock Vina 1.1.2, we have carried out a redocking benchmark on the 2,455 protein-ligand complexes of the refined set of PDBbind v2011 and 343 protein-ligand complexes of CSAR NRC HiQ Set 24Sept2010, and a virtual screening benchmark on 12 diverse receptors and 3000 ligands of different molecular weight. The results have shown that under various circumstances idock displayed comparable success rates but outperformed AutoDock Vina in terms of docking speed by at least 8.69 times and at most 37.51 times, rendering idock particularly suitable for large-scale protein-ligand docking. Specifically for istar, we have developed a customized daemon from idock 1.6, implementing our novel idea of two-phase docking due to as many as 12 million ligands, and exploiting both fine-grained slice-level parallelism in phase 1 and coarse-grained job-level parallelism in phase 2 in order to further shorten job execution time, as well as using gzip to compresses result files in order to save server storage and network bandwidth. We have prepared two graphical tutorials for newbies to get started easily. Besides idock on our istar platform, we have also hosted our igrep, a fast CUDA implementation of agrep algorithm for approximate nucleotide sequence matching. We have tested our istar web site with Chrome 19+, Firefox 12+, IE 9+, Safari 5+ and Opera 12+. We plan to utilize GPU acceleration in a future release of idock and deploy GPU clusters for further speed up, aiming to make istar a really pragmatic large-scale online docking platform for the computational chemistry community and pharmaceutical companies.
\end{abstract}

\begin{wileykeywords}
docking, virtual screening, web.
%A list of five key words or phrases which best characterize the paper are required for indexing.
\end{wileykeywords}

\clearpage

%*****************Graphical Table of Contents******************** THIS IS MANDATORY *******************


\begin{figure}[h]
\centering
\colorbox{background-color}{
\fbox{
\begin{minipage}{1.0\textwidth}
\includegraphics[width=55mm,height=50mm]{GTOC.png} % Pick only one of the two styles by uncommenting the corresponding \includegraphics
%\includegraphics[width=110mm,height=20mm]{Architecture.png}
\\
We were motivated to automate large-scale protein-ligand docking using our docking engine idock and thus have developed istar, a SaaS (Software as a Service) platform capable of hosting a general variety of software online. Without tedious software installation, users can submit jobs on the fly either by browsing our web site or by programming against our RESTful API. Our HTML5- and CSS3-powered web site supports several unique features that cannot be found on other platforms.
\end{minipage}
}}
\end{figure}

% makes references listed with 1., 2., etc.  
  \makeatletter
  \renewcommand\@biblabel[1]{#1.}
  \makeatother

\bibliographystyle{apsrev}

\renewcommand{\baselinestretch}{1.5}
\normalsize


\clearpage


\section*{\sffamily \Large SUMMARY}

We have developed istar, a general SaaS (Software as a Service) platform with large-scale online protein-ligand docking. Without tedious software installation, users can submit jobs on the fly either by browsing our web site or by programming against our RESTful API. Our HTML5- and CSS3-powered web site supports 1) selecting ligands with desired molecular properties and previewing the number of ligands to dock, 2) monitoring job progress in real time, and 3) outputing predicted free energy, ligand efficiency, putative hydrogen bonds, and supplier information, three very useful features commonly lacked on other online docking platforms like DOCK Blaster \citep{557} or iScreen \citep{899}. We have collected 12,171,187 yuck-free ligands from the clean subset of ZINC \citep{1178} with conditional permission from its developer. We have revised our docking engine idock to version 1.6, further improving docking speed and accuracy, inventing new functionalities, and fixing bugs. We have developed an istar-customized daemon from idock 1.6, implementing two-phase docking and exploiting fine-grained slice-level parallelism in order to further shorten job execution time, as well as using gzip to compresses result files in order to save server storage and network bandwidth. We have also prepared two graphical tutorials for newbies to get started easily. We have tested the istar web site with Chrome 19+, Firefox 12+, IE 9+, Safari 5+ and Opera 12+.

\section*{\sffamily \Large INTRODUCTION} % Not needed for rapid communications

Protein-ligand docking predicts the preferred conformation and binding affinity of a small ligand when it is non-covalently bound to a specific binding site of a macro protein. Up to date, there are hundreds of docking programs \citep{493,922}. The AutoDock series is the most cited docking software in the research community. AutoDock has contributed to the discovery of several drugs, including the first clinically approved HIV integrase inhibitor \citep{1169}. Technically speaking, AutoDock is single threaded \textit{per se}. Following its initial release, several parallel implementations were developed, using either multithreading or computer cluster \citep{115,560,782}.

In 2009, AutoDock Vina \citep{595} was released. As the successor of AutoDock 4 \citep{596}, AutoDock Vina significantly improves the average accuracy of the binding mode predictions while running two orders of magnitude faster with multithreading \citep{595}. It was compared to AutoDock 4 on selecting active compounds against HIV protease, and was recommended for docking large molecules \citep{556}. Its functionality of semi-flexible protein docking by enabling flexibility of side-chain residues was evaluated on VEGFR-2 \citep{1084}. To further facilitate the usage of AutoDock Vina, auxiliary tools were subsequently developed, including a PyMOL plugin for program settings and visualization \citep{609}, and a bootable operating system for computer clusters \citep{773}. AutoDock Vina is free and open source under Apache License 2.0. So far it has been cited by over 400 publications according to Google Scholar, making it a very competitive docking program.

In 2011, inspired by AutoDock Vina, we developed idock 1.0 \citep{1153}, a multithreaded virtual screening tool for flexible ligand docking. idock inherits from AutoDock Vina the accurate scoring function and the efficient optimization algorithm, and meanwhile introduces a fruitful of innovations, such as receptor and grid map caching for large-scale virtual screening, revised numerical model for much faster approximation, capability of automatic detection and deactivation of inactive torsions, utilization of our lightweight thread pool to parallelize grid map creation and reuse threads, utilization of the new C++11 feature of rvalue references to avoid frequent memory reallocation, and accelerated parsers for both receptor and ligand. When benchmarked on docking 10,928 drug-like ligands against HIV reverse transcriptase, idock 1.0 achieved a speedup of 3.3 in terms of CPU time and a speedup of 7.5 in terms of elapsed time on average compared to AutoDock Vina.

Having released idock, we kept receiving docking requirements from our colleagues and collaborators. They are mostly biochemists and pharmacists, outsourcing the docking research to us after discovering potential biological targets for certain diseases of therapeutic interest. All of a sudden, we had to grab the protein structure, do format conversion, define search space, set up docking parameters, and keep running idock in batch for months. Tedious enough, all the above work was done manually, resulting in very low research productivity. In order to boost efficiency and automate large-scale protein-ligand docking using our idock, we therefore developed istar, a general SaaS platform.

\section*{\sffamily \Large METHODOLOGY}

Figure \ref{architecture} shows the architecture of istar. There are five major components: a web site, a web server, a database management system, several workstations, and a network file system. Under typical circumstance, a user browses our web site and submits a job. The web server first validates user input and then saves it into database. Several workstations run daemons in the background, fetching jobs from the database and carrying out experiments. Upon completion, they send a notification email to the user and write the result to the network file system, which is served and cached as static content. The user again browses our web site to download result or monitor job progress.

\begin{figure}
\centerline{\includegraphics[width=\linewidth]{Architecture.png}}
\caption{istar architecture.}\label{architecture}
\end{figure}

On the client side, we seamlessly combined both the Twitter Bootstrap and the HTML5 Boilerplate into a HTML5- and CSS3-powered web site, which was successfully checked as HTML5 by the W3C Markup Validator v1.3. We adopted the \textit{de facto} jQuery library to simplify HTML document traversing, event handling, animating, and Ajax interactions, and the jQuery UI library to provide themeable widgets. We tested the web site with Chrome 19+, Firefox 12+, Internet Explorer 9+, Safari 5+ and Opera 12+, and utilized the Modernizr library to detect HTML5 and CSS3 features in order to maintain backward compatibility in older browsers.

On the server side, we built the web server in the same JavaScript language using the well-known asynchronous event-driven node.js on top of the express server, forking multiple worker processes to accept simultaneous HTTP/SPDY connections. We utilized the spdy node module to support SPDY protocol v3, the prototype of next generation HTTP 2.0, achieving reduced latency through compression, multiplexing, and prioritization. We employed the forever node module to restart worker processes automatically in case of unhandled exceptions, ensuring failover and high availability. We made use of regular expressions and developed a customized version of the validator node module to validate and sanitize user input upon job receival, ensuring data validity.

On the database side, we chose MongoDB, a scalable, high-performance, open source NoSQL database. MongoDB features document store in JSON style, making it particularly suitable for applications requiring flexible document attributes like our istar. MongoDB is written in C++, making it easy to manipulate the database from idock and igrep, which are also written in C++. By using a 10gen-supported native MongoDB driver for node.js, the web server is able to save user input as jobs into MongoDB.

On the workstation side, we deployed a Linux workstation and a Linux virtual machine. The workstation is equipped with Intel Xeon W3520 @ 2.66 GHz, 8GB DDR3 SDRAM and NVIDIA GeForce GTX 285 (1024 MB), and 
 running a minimal version of Fedora 17 x64.

On the network file system side, we mounted a 2TB hard disk for shared use. All the 5 workstations can simultaneously access to the hard disk and perform file reading and writing. In principle, we will persist existing jobs and results until storage shortage.

\subsection{Enhancements}

Vina is optimized for single-ligand docking rather than virtual screening. When it comes to docking a large pool of ligands, Vina has to be invoked multiple times, repeatly parsing the same receptor and creating the same grid maps, thus degrading performance. idock supports virtual screening in a native manner. It docks a directory of ligands instead of a single ligand, and reuses receptor and grid maps.

idock implements a lightweight thread pool in order to reuse threads and maintain a high CPU utilization throughout the entire screening procedure (Figure \ref{ThreadPool}). During program initialization, idock creates a thread pool of $N$ threads, where $N$ is the number of CPU cores automatically detected, or can be specified by user via a command line argument. When idle, the threads sleep. When tasks arrive, the threads compete for tasks. The thread that completes its current task will automatically fetch a pending one to execute until all are done. Synchronization is implemented to ensure full completeness of the tasks and availability of results. The task here is an abstract concept in programming sense and can be instantiated either as scoring function task, grid map task or Monte Carlo task. To be exact, the thread pool in fact parallelizes the precalculation of scoring function, the creation of grid maps, and the execution of Monte Carlo tasks.

idock supports reading and writing compressed ligand files with in gzip/bzip2 format, resulting in a file footprint as low as just one eighth of the raw size using gzip. This new functionality turns out to be extremely handy given an enormous amount of ligands to dock.

Vina supports 16 chemical elements. idock adds 9 additional elements and thus supports as many as 25 chemical elements including rare ones like As (arsenic) and Sr (strontium), covering the majority of ligand atom types.

idock implements our own lightweight thread-safe progress bar, reporting progress every 10\% Monte Carlo tasks per ligand. idock better supports rvalue references and move semantics in C++11 to boost performance. idock flattens the tree-like recursive data structure of ligand as used in AutoDock Vina into simple linear array structure to ensure a high data cache hit rate and easy coding. idock accelerates the assignment of atom types by making use of residue information for receptor and branch information for ligand.

idock outputs verbose information to docked PDBQT files, including total free energy normalized by torsional degree of freedom (Equation \eqref{eqn:FlexibilityPenalty}), total free energy, inter-ligand free energy, intra-ligand free energy, putative hydrogen bonds, and per-atom inter-ligand free energy (Figure \ref{OutputPDBQT}). The normalized total free energy is used in ligand ranking. The output of total free energy, inter-ligand free energy and intra-ligand free energy provides an alternative ranking option using derived efficiency indexes \citep{335,336,337}. The per-atom inter-ligand free energy facilitates interaction hotspot determination, and helps improving potency by altering certain chemical moieties while retaining those critical for binding.

\begin{figure}
\centering
\includegraphics[width=\textwidth]{OutputPDBQT.png}
\caption{Verbose output of idock in PDBQT format.}
\label{OutputPDBQT}
\end{figure}

idock extracts the above records from docked PDBQT files, sorts them in the ascending order of normalized total free energy, and writes them to a CSV (Comma-Separated Vector) file for subsequent analysis (Figure \ref{OutputCSV}). Users can derive their own efficiency indexes \citep{335,336,337} and re-sort the records for their particular applications.

\begin{figure}
\centering
\includegraphics[width=\textwidth]{OutputCSV.png}
\caption{Summary output of idock in CSV format.}
\label{OutputCSV}
\end{figure}

\section{Benchmarks and Results}

idock x86\_64 v1.5 and AutoDock Vina x86 v1.1.2 were evaluated on desktop computers with Intel Core i5-2400 CPU @ 3.10GHz and 4GB DDR3 RAM under Mac OS X 10.7.4 Build 11E53. Arguments to both programs were left as default. By default, both programs output 9 predicted conformations per ligand. The benchmarks include comparison of their redocking performance in terms of predicted conformations, and comparison of their virtual screening performance in terms of execution time, memory usage, predicted free energy, and predicted conformations.

\subsection{Benchmark of Redocking}

Redocking refers to randomizing the crystal ligand conformation in a protein-ligand complex and trying to dock the randomized conformation back to its crystal conformation as close as possible. For the redocking benchmark, we used two databases, PDBbind v2011 \citep{529,530} and CSAR NRC HiQ Set 24Sept2010 \citep{857,960}. The refined set of PDBbind v2011 and the two sets of CSAR NRC HiQ Set 24Sept2010 comprise 2,455 and 343 protein-ligand complexes respectively, with experimentally determined binding affinity data (Kd or Ki).

Table \ref{SuccessRate} shows the success rates of idock and AutoDock Vina under various conditions regarding the RMSD values between the crystal and docked conformations. Given a redocking case, RMSD1 refers to the RMSD value between the crystal conformation and the first docked conformation, i.e. the one with the highest predicted binding affinity, while RMSDm refers to the RMSD value between the crystal conformation and the closest docked conformation, i.e. the one with the minimum RMSD value. The condition RMSD1 = RMSDm tests for how many percent the docked conformation with the highest predicted binding affinity actually turns out to be the closest one among the 9 predicted conformations. It can be seen that the success rates of idock are comparable to, albeit slightly lower than, AutoDock Vina, and the success rates on CSAR NRC HiQ Set 24Sept2010 are consistently higher than PDBbind v2011, probably because the scoring function performs well on carefully refined structures. Using a RMSD value of 2.0 \AA, a publicly accepted positive control for correct bound structure prediction, both programs manage to predict a conformation close enough to the crystal conformation as the first conformation for over half of the cases on both databases.

\begin{table}
\centering
\begin{tabular*}
{\linewidth}
{@{\extracolsep{\fill}}crrrr}
\toprule
& \multicolumn{2}{c}{PDBbind v2011} & \multicolumn{2}{c}{CSAR NRC HiQ}\\
Condition & idock & Vina & idock & Vina\\
\midrule
RMSD1 = RMSDm           & 47\% & 54\% & 57\% & 71\%\\
RMSD2 = RMSDm           & 16\% & 14\% & 17\% & 13\%\\
RMSD3 = RMSDm           &  8\% &  8\% &  7\% &  4\%\\
RMSD4 = RMSDm           &  6\% &  5\% &  5\% &  3\%\\
RMSD5 = RMSDm           &  5\% &  5\% &  4\% &  1\%\\
RMSD6 = RMSDm           &  5\% &  4\% &  3\% &  3\%\\
RMSD7 = RMSDm           &  5\% &  4\% &  1\% &  2\%\\
RMSD8 = RMSDm           &  4\% &  3\% &  3\% &  2\%\\
RMSD9 = RMSDm           &  4\% &  3\% &  3\% &  2\%\\
\noalign{\smallskip}
RMSD1 \textless\ 0.5 \AA & 11\% & 12\% & 21\% & 21\%\\
RMSD1 \textless\ 1.0 \AA & 29\% & 31\% & 40\% & 47\%\\
RMSD1 \textless\ 1.5 \AA & 45\% & 47\% & 61\% & 67\%\\
RMSD1 \textless\ 2.0 \AA & 53\% & 56\% & 68\% & 73\%\\
RMSD1 \textless\ 2.5 \AA & 58\% & 61\% & 72\% & 76\%\\
\noalign{\smallskip}
RMSDm \textless\ 0.5 \AA & 14\% & 15\% & 24\% & 26\%\\
RMSDm \textless\ 1.0 \AA & 39\% & 40\% & 54\% & 55\%\\
RMSDm \textless\ 1.5 \AA & 64\% & 65\% & 78\% & 84\%\\
RMSDm \textless\ 2.0 \AA & 74\% & 78\% & 86\% & 92\%\\
RMSDm \textless\ 2.5 \AA & 79\% & 84\% & 90\% & 94\%\\
\bottomrule
\end{tabular*}
\caption{Redocking benchmark results: redocking success rates of idock and AutoDock Vina on PDBbind v2011 and CSAR NRC HiQ Set 24Sept2010 under various conditions regarding the RMSD (Root Mean Square Deviation) values between the crystal and docked conformations. Arguments to both programs were left as default. Both programs output 9 conformations per ligand by default. RMSD1 refers to the RMSD value between the crystal conformation and the first docked conformation with the highest predicted binding affinity, while RMSDm refers to the RMSD value between the crystal conformation and the closest docked conformation with the lowest RMSD value. The condition RMSD1 = RMSDm therefore tests for how many percent the docked conformation with the highest predicted binding affinity actually turns out to be the closest one among the 9 predicted conformations. It can be seen that the success rates of idock were comparable to, albeit slightly lower than, AutoDock Vina. Using a RMSD value of 2.0 \AA, a publicly accepted positive control for correct bound structure prediction, both programs managed to predict a conformation close enough to the crystal conformation as the first conformation for over half of the cases on both datasets.}
\label{idock:SuccessRate}
\end{table}

Figure \ref{Redocking} visualizes the redocking results of four cases.

\begin{figure*}
\centering
\subfloat[PDB ID 1B8N. Vina RMSD1 = 0.139 \AA. idock RMSD1 = 0.127 \AA.]
{
  \includegraphics[width=0.485\linewidth]{Redocking1B8N.png}
}
\subfloat[PDB ID 4TMN. Vina RMSD1 = 8.401 \AA. idock RMSD1 = 9.909 \AA.]
{
  \includegraphics[width=0.485\linewidth]{Redocking4TMN.png}
}
\\
\subfloat[PDB ID 1PKX. Vina RMSD1 = 7.059 \AA. idock RMSD1 = 0.214 \AA.]
{
  \includegraphics[width=0.485\linewidth]{Redocking1PKX.png}
}
\subfloat[PDB ID 3HV8. Vina RMSD1 = 0.290 \AA. idock RMSD1 = 10.232 \AA.]
{
  \includegraphics[width=0.485\linewidth]{Redocking3HV8.png}
}
\caption{Redocking results of four cases.}
\label{Redocking}
\end{figure*}

Figure \ref{FECorrelation} shows the free energy correlation of idock and AutoDock Vina. On the CSAR NRC HiQ Set 24Sept2010 database, the Pearson correlations between experimental binding affinity and free energy predicted by AutoDock Vina, between experimental binding affinity and free energy predicted by idock, and between free energy predicted by AutoDock Vina and idock are -0.5998758, -0.5774972, and 0.9824049, respectively. The experimental binding affinity is positive while the predicted free energy is negative, hence the negative sign for the former two correlations. It can be seen that both programs fail to predict reliable free energy, a very common obstacle in the entire research community. As expected, the correlation between free energy predicted by both programs is very close to 1 because of their identical scoring function.

\begin{figure*}
\centering
\subfloat[PDBbind v2011]
{
  \includegraphics[width=0.485\linewidth]{PDBbindFECorrelation.pdf}
}
\subfloat[CSAR NRC HiQ Set 24Sept2010]
{
  \includegraphics[width=0.485\linewidth]{CSARFECorrelation.pdf}
}
\caption{Free energy correlation on PDBbind v2011 and CSAR NRC HiQ Set 24Sept2010.}
\label{FECorrelation}
\end{figure*}

\subsection{Benchmark of Virtual Screening}

We collected 12 receptors from the PDB (Protein Data Bank) database \cite{540,537}, and 1000 ligands with a molecular weight of 200-300g/mol2, 1000 ligands with a molecular weight of 300-400g/mol2, and 1000 ligands with a molecular weight of 400-500g/mol2 from the clean subset of the ZINC database \cite{532,1178}. The 3000 ligands (Figure \ref{MWT-NRB}) were docked against the 12 receptors by Vina and idock. Since Vina can dock only one ligand in each run, a bash script containing 1000 lines was executed instead, with each line being an execution of Vina to dock one individual ligand. The GNU Time utility was used as profiler.

\begin{figure*}
\centering
\subfloat
{
  \includegraphics[width=0.485\linewidth]{MWT.pdf}
}
\subfloat
{
  \includegraphics[width=0.485\linewidth]{NRB.pdf}
}
\caption{Boxplot of molecular weight and number of rotatable bonds of ligands of the three molecular weight sets.}
\label{MWT-NRB}
\end{figure*}

Table \ref{ExecutionTime} compares the CPU time and elapsed time of both programs. The execution time varies a lot from receptor to receptor and from molecular weight set to set, so does the ratio. Conclusively idock outperforms Vina by at least 8.69 and at most 37.51 times.

\begin{table}
\centering
\begin{tabular*}
{\linewidth}
{@{\extracolsep{\fill}}crrrrrr}
\toprule
& \multicolumn{2}{c}{200-300g/mol} & \multicolumn{2}{c}{300-400g/mol} & \multicolumn{2}{c}{400-500g/mol}\\
& CPU & Elapsed & CPU & Elapsed & CPU & Elapsed\\
\midrule
\multicolumn{7}{l}{\textbf{1HCL} human cyclin-dependent kinase 2}\\
Vina  & 12.57 &  3.33 & 22.55 &  5.91 & 51.62 & 13.41\\
idock &  0.63 &  0.16 &  0.92 &  0.24 &  1.38 &  0.36\\
\multicolumn{7}{l}{\textbf{1J1B} human tau protein kinase I}\\
Vina  &  9.07 &  2.47 & 14.69 &  3.92 & 32.28 &  8.49\\
idock &  0.78 &  0.21 &  1.25 &  0.33 &  2.35 &  0.62\\
\multicolumn{7}{l}{\textbf{1LI4} human S-adenosylhomocysteine hydrolase}\\
Vina  & 11.82 &  3.30 & 19.08 &  5.22 & 39.41 & 10.64\\
idock &  0.89 &  0.23 &  1.55 &  0.40 &  3.15 &  0.82\\
\multicolumn{7}{l}{\textbf{1V9U} human rhinovirus 2 coat protein VP1}\\
Vina  &  9.80 &  2.95 & 15.55 &  4.62 & 29.75 &  8.49\\
idock &  0.97 &  0.25 &  1.64 &  0.42 &  3.42 &  0.89\\
\multicolumn{7}{l}{\textbf{2IQH} influenza A virus nucleoprotein NP}\\
Vina  &  9.51 &  2.66 & 15.03 &  4.08 & 29.64 &  7.83\\
idock &  0.92 &  0.24 &  1.59 &  0.41 &  3.41 &  0.88\\
\multicolumn{7}{l}{\textbf{2XSK} Escherichia coli curli protein CsgC - SeCys}\\
Vina  & 10.44 &  2.71 & 17.89 &  4.61 & 40.58 & 10.41\\
idock &  0.71 &  0.19 &  1.16 &  0.30 &  2.16 &  0.56\\
\multicolumn{7}{l}{\textbf{2ZD1} HIV-1 reverse transcriptase}\\
Vina  &  9.78 &  2.70 & 17.67 &  4.76 & 42.03 & 11.33\\
idock &  0.97 &  0.25 &  1.52 &  0.39 &  2.60 &  0.69\\
\multicolumn{7}{l}{\textbf{2ZNL} influenza virus RNA polymerase subunit PA}\\
Vina  &  9.49 &  2.60 & 15.04 &  4.01 & 29.97 &  7.82\\
idock &  0.89 &  0.23 &  1.56 &  0.40 &  3.41 &  0.87\\
\multicolumn{7}{l}{\textbf{3BGS} human purine nucleoside phosphorylase}\\
Vina  &  9.59 &  2.57 & 16.50 &  4.37 & 38.42 & 10.14\\
idock &  0.95 &  0.25 &  1.55 &  0.40 &  2.81 &  0.74\\
\multicolumn{7}{l}{\textbf{3H0W} human S-adenosylmethionine decarboxylase}\\
Vina  &  9.85 &  2.64 & 17.67 &  4.70 & 41.69 & 11.04\\
idock &  0.88 &  0.23 &  1.35 &  0.35 &  2.20 &  0.58\\
\multicolumn{7}{l}{\textbf{3IAR} human adenosine deaminase}\\
Vina  & 11.25 &  3.03 & 20.21 &  5.39 & 46.93 & 12.53\\
idock &  0.80 &  0.21 &  1.21 &  0.32 &  2.01 &  0.53\\
\multicolumn{7}{l}{\textbf{3KFN} HIV protease}\\
Vina  & 10.53 &  2.80 & 18.37 &  4.83 & 42.43 & 11.03\\
idock &  0.77 &  0.20 &  1.20 &  0.32 &  2.09 &  0.55\\
\multicolumn{7}{l}{\textbf{Average across the above 12 receptors}}\\
Vina  & 10.31 &  2.81 & 17.52 &  4.70 & 38.73 & 10.26\\
idock &  0.85 &  0.22 &  1.38 &  0.36 &  2.58 &  0.67\\
\bottomrule
\end{tabular*}
\caption{CPU time and elapsed time in hours of docking 3000 clean ligands of 3 molecular weight sets against 12 receptors by Vina and idock.}
\label{ExecutionTime}
\end{table}

\section*{\sffamily \Large idock on istar}

We hosted idock onto istar. On the client side, figure \ref{idock} shows the web site of idock. The upper section displays information about existing jobs, including the number of ligands to dock, submission date, current status and progress, and result for download. Client-side paging is supported, and an Ajax timer is started to automatically refresh the status and progress in real time by querying against the web server every second, a very useful feature commonly lacked in other SaaS platforms like DOCK Blaster \citep{557} or iScreen \citep{899}. The lower section allows new job submission. A new job typically consists of several compulsory fields as well as several optional fields. Compulsory fields include a receptor in PDBQT format, a search space defined by a cubic box, a short job description, and an email to receive completion notification. Optional fields include 9 ligand filtering conditions, like molecular weight, partition coefficient xlogP, apolar desolvation, polar desolvation, number of hydrogen bond donors, number of hydrogen bond acceptors, topological polar surface area tPSA, net charge, and number of rotatable bonds. We set up default values for optional fields, and only the ligands satisfying all the 9 filtering conditions will be docked. Figure \ref{idock-rest} shows the RESTful API of idock. We expose the functionalities of job submission, job query, and ligand counting as RESTful API for others to program against. We prepared two graphical tutorials for newbies to get started in order to correctly fill in the compulsory fields. Tutorial 1 is about how to prepare a receptor in PDBQT format with MGLTools \citep{596}. Tutorial 2 is about how to define a binding site with MGLTools \citep{596}, Chimera \citep{1219} or PyMOL \citep{1221}. We deliberately did not introduce an automatic protein binding site detection tool but let the tutorials guide this process with proper customization.

\begin{figure}
\centering
\includegraphics[width=\linewidth]{istar/idock.png}
\caption{idock web site on istar available at http://idock.cse.cuhk.edu.hk}
\label{idock}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=\linewidth]{istar/idock-rest.png}
\caption{RESTful API of idock.}
\label{idock-rest}
\end{figure}

On the server side, during startup, the master process loads and parses 9 molecular properties of 12,171,187 ligands (Figure \ref{LigandProperties}), and awaits queries from worker processes through inter-process message passing. Upon receival of a query from a worker process, the master process performs an in-memory table scan and calculates the number of ligands satisfying a given combination of filtering conditions on those 9 molecular properties. The ligand count is signaled to the query-invoking worker process and then forwarded to the client side. The entire round trip costs approximately one second, rendering the feasibility of real-time ligand counting queries for users to estimate in advance how many ligands will be docked. Originally we stored the 9 molecular properties in MongoDB, but our in-house trial showed that it took about 9 seconds to complete a ligand counting query even in the presence of index and even having the data stored in a RAM disk. Disappointed by the poor performance of MongoDB given 12 million documents, we decided to abandon this design and let the master process hold the data in memory throughout its lifecycle.

\begin{figure}
\centering
\subfloat
{
  \includegraphics[width=0.315\linewidth]{istar/mwt.pdf}
}
\subfloat
{
  \includegraphics[width=0.315\linewidth]{istar/logp.pdf}
}
\subfloat
{
  \includegraphics[width=0.315\linewidth]{istar/ad.pdf}
}
\\
\subfloat
{
  \includegraphics[width=0.315\linewidth]{istar/pd.pdf}
}
\subfloat
{
  \includegraphics[width=0.315\linewidth]{istar/hbd.pdf}
}
\subfloat
{
  \includegraphics[width=0.315\linewidth]{istar/hba.pdf}
}
\\
\subfloat
{
  \includegraphics[width=0.315\linewidth]{istar/tpsa.pdf}
}
\subfloat
{
  \includegraphics[width=0.315\linewidth]{istar/charge.pdf}
}
\subfloat
{
  \includegraphics[width=0.315\linewidth]{istar/nrb.pdf}
}
\caption{Distributions of 9 molecular properties of the 12,171,187 clean ligands.}
\label{LigandProperties}
\end{figure}

On the network file system side, we collected 12,171,187 clean ligands at pH 7 in mol2 format from the fruitful ZINC database \citep{532,1178} with explicit permission of its major developer and maintainer, Prof. John J. Irwin at University of California, San Francisco. Originally the yuck-compound-free ligands are organized into 98 slices, with each slice containing approximately 125,000 clean ligands, among which about 75,000 (60\%) have a molecular weight of at least 350g/mol, the minimum weight requirement that a modern drug should bear. We converted all the 12 million ligands into PDBQT format in batch, and combined the 12 million individual files and integrated their 9 molecular properties into one single file as huge as 50GB for subsequent parallel docking. The format conversion alone required 2 months. We also recorded and encoded the offset of each ligand within that big file for fast random seeking.

On the workstation side, we developed a customized version of idock as a daemon in modern C++11, adding necessary code to iteratively fetch a pending job slice from MongoDB, reuse receptor and grid maps whenever possible, perform 2-phase docking, report progress to MongoDB, and send email notification upon job completion. We deliberately configured the grid map granularity to 0.1\AA\ in order to lower down memory consumption due to the 4GB RAM limit of the Mac workstations.

On one hand, the idock on istar features 2-phase docking (Figure \ref{2PhaseDocking}), due to as many as 12 million ligands to screen. In phase 1, idock performs coarse but fast virtual screening without writing any conformations to file, aiming to quickly shortlist a few thousand candidate compounds. In phase 2, idock performs fine but slow virtual screening with a significantly larger number of Monte Carlo tasks per ligand, writing as many conformations to file as possible and aiming to refine the predicted free energy as well as predicted conformation of candidate compounds. Such a 2-phase docking methodology can remarkably reduce job execution time while avoiding the risk of filtering out potentially promising compounds, controlling the false negative rate at an acceptable level.

\begin{figure}
\centering
\includegraphics[width=\linewidth]{2PhaseDocking.png}
\caption{istar 2-phase docking.}
\label{2PhaseDocking}
\end{figure}

On the other hand, the idock on istar features slice-level parallelism in phase 1. Generally speaking, multiple workstations can compete for either jobs or slices, with the former known as job-level parallelism and the latter as slice-level parallelism (Figure \ref{2LevelParallelism}). Job-level parallelism is very straightforward to implement and can ensure high utilization of computational power when the number of jobs exceeds the number of workstations. Nevertheless, when the number of workstations exceeds the number of jobs, which is usually the case in practice during the initial stage of istar, slice-level parallelism can better utilize computational power by subdividing a job into slices which are then distributed to workstations. Slice-level parallelism is, in contrast, difficult to implement on both the database side and the workstation side. The technical hurdle becomes even more apparent when results from multiple workstations must be properly combined to produce a final result and progresses from multiple workstations must be properly combined too to compute an overall progress. Finally we succeeded in splitting a job into 100 slices and distributing them to idle workstations in phase 1 to achieve parallel docking.

\begin{figure}
\centering
\subfloat[Job-level parallelism.]
{
  \label{JobLevelParallelism}
  \includegraphics[width=\linewidth]{JobLevelParallelism.png}
}
\\
\subfloat[Slice-level parallelism.]
{
  \label{SliceLevelParallelism}
  \includegraphics[width=\linewidth]{SliceLevelParallelism.png}
}
\caption{istar 2-level parallelism.}
\label{2LevelParallelism}
\end{figure}

Together with 2-phase docking as well as slice-level parallelism, using a Mac workstation alone, on average it takes a week to complete one single slice. Therefore, even though we thoroughly utilize all the 4 Mac workstations, it can take up to 5 months to complete one single job. Currently we have 3 jobs at hand, adding up to 15 months, and we believe more jobs are coming in the future. In order to boost job execution, we plan to port idock to GPU using both CUDA and OpenCL/WebCL in both C++ and JavaScript and deploy new workstations equipped with high-end GPU chips.

ligand efficiency indexes \citep{335,336,337}

\subsection*{\sffamily \large RESULTS}
%\subsubsection*{\sffamily \normalsize Third-order heading}
%{\sffamily \small Fourth-order heading}\\

Despite the amazing speedup, idock 1.0 still required about 10 hours on average to dock 10,928 drug-like ligands, not to mention massive docking of millions of ligands. Faster algorithms and implementations are highly desired. Following the release of idock 1.0 in July 2011, we then released idock 1.1 in December 2011, idock 1.2 in February 2012, idock 1.3 in March 2012, idock 1.4 in April 2012, idock 1.5 in June 2012, and idock 1.6 in August 2012, further improving docking speed and accuracy, inventing new functionalities, and fixing bugs. Refer to the idock web site for a full list of enhancements and bugfixes.

\section*{\sffamily \Large igrep on istar}

In addition to idock, we also hosted our igrep \citep{1138} onto istar. igrep was developed two years ago and is a fast CUDA implementation of agrep algorithm for approximate nucleotide sequence matching. In order to host igrep onto istar, we have rewritten the entire code and upgraded 26 genomes. igrep is now available at http://istar.cse.cuhk.edu.hk/igrep. The successful hosting of igrep onto istar demonstrates the capability of istar of hosting a general variety of programs.

\section*{\sffamily \Large DISCUSSION}

There are other online protein-ligand docking platforms. DOCK Blaster \citep{557}, an expert system, was created to investigate the feasibility of full automation of large-scale protein-ligand docking. 

Here we highlight the advantages of istar over DOCK Blaster. First and foremost, istar is free and open source under Apache License 2.0. Everyone is welcome to download a copy and deploy istar to his/her own servers. istar is designed as a general SaaS platform. It can host not only idock but also igrep and any other program. istar utilizes HTML5, CSS3, node.js, SPDY, NoSQL, GPU acceleration and so on, representing a state-of-the-art platform. istar supports filtering and previewing ligands to dock, as well as monitoring job progress in real time, two very useful features only available at istar. istar implements 2-phase docking and exploits fine-grained slice-level parallelism in phase 1.

Due to limited budget, we could not offer hardware resource as much as DOCK Blaster did (i.e. 700 CPU cores plus 20TB RAID-6 storage), so we tried every endeavor on software optimization. Alternatively, one can freely deploy a copy of istar. In the future we plan to port idock to GPU in order to further boost performance.

%\section*{\sffamily \Large CONCLUSIONS}

%((Place Conclusions here.))

\subsection{Availability}
We emphasize full reproducibility. Both idock and istar are free and open source under Apache License 2.0. For idock, its C++ source code, precompiled executables for 32-bit and 64-bit Linux, Windows, Mac OS X, FreeBSD and Solaris, 13 docking examples, and a doxygen file for generating API documentations are available at https://github.com/HongjianLi/idock. For istar, its C++ and JavaScript source code is available at https://github.com/HongjianLi/istar. A live demo is running at http://istar.cse.cuhk.edu.hk.

2 graphical tutorials on how to prepare a receptor in PDBQT format with MGLTools \citep{596} and on how to define a binding site with MGLTools \citep{596}, Chimera \citep{1219} or PyMOL \citep{1221}.

\subsection*{\sffamily \large ACKNOWLEDGMENTS}

We thank Professor John J. Irwin, the developer and maintainer of ZINC, for granting us permission to use ZINC with three conditions:
\begin{enumerate}
\item We shall provide links to http://zinc.docking.org/substance/zincid for top hits so that users can seek for the most current purchasing information at ZINC's official web site.
\item We shall limit the number of top hits for download to 1000 ligands from a single job.
\item We shall update our ligands when ZINC data is updated so that users can benefit from the most current ligand data.
\end{enumerate}

%((Additional Supporting Information may be found in the online version of this article.))

\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BIBLIOGRAPHY

\bibliography{../refworks}   % Produces the bibliography via BibTeX.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FIGURE CAPTIONS

%%%%% FIGURE ---- cc.eps
\begin{figure}
\caption{\label{cc} Place Figure 1 caption here. In the case of reproduced figures in review articles, you must obtain the publisher's permission and state a suitable notice here along with a citation.}
\end{figure}

\begin{figure}
\caption{\label{fig2} Place Figure 2 caption here. Figures should be uploaded as individual files, preferably .tif or .eps files, at high enough resolution (600 to 1200 dpi) to ensure clarity. Please see the author’s guide for more details and specifications. For high quality illustrations, we highly recommend the use of the TikZ package.}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FIGURE FILES

\clearpage

%\vspace*{0.1in}   %%% FIGURE 1
\begin{center}
%\includegraphics[width=0.2\columnwidth,keepaspectratio=true]{cc.eps}
\end{center}
\vspace{0.25in}
\hspace*{3in}
{\Large
\begin{minipage}[t]{3in}
\baselineskip = .5\baselineskip
Figure 1 \\
Author A, Author B, Author C, Author D \\
J.\ Comput.\ Chem.
\end{minipage}
}

\clearpage

\begin{table}
\begin{tabular}{|c|c|c|c|}\hline
\textbf{Quantity} & \textbf{Calculated} & \textbf{Observed} & \textbf{Error} \\ \hline
  Density & 5.3 & 6.3 & Within limits \\ \hline
  Optical magnification & 8.3 & 90.9 & Utterly unacceptable\! \\ \hline
\end{tabular}
\caption{\label{tbl1} Place table caption here.}
\end{table}

\end{document}

